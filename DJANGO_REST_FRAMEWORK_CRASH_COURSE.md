# Django REST Framework (DRF) Crash Course

This document provides a focused crash course on the key components of the **Django REST Framework (DRF)** used in the HopeHands project to build the backend API.

DRF is a powerful toolkit for building Web APIs. It works with Django's standard models and views but makes it much easier to handle the process of converting data to JSON and building flexible API endpoints. The main pattern we use is **Model -> Serializer -> ViewSet**.

---

## 1. The Serializer: From Model to JSON

The first step in exposing our `Volunteer` model via the API is to define how it should be converted to and from JSON. This is the job of a serializer.

**File:** `hopehands/volunteer/serializers.py`

```python
from rest_framework import serializers
from .models import Volunteer

class VolunteerSerializer(serializers.ModelSerializer):
    """
    Serializes Volunteer model instances into JSON format.
    """
    class Meta:
        model = Volunteer
        fields = [
            'id', 'first_name', 'last_name', 'email', 'phone_number',
            'preferred_volunteer_role', 'availability',
            'how_did_you_hear_about_us', 'status', 'hubspot_id'
        ]
        # These fields are managed by the backend and cannot be changed by the client.
        read_only_fields = ['status', 'hubspot_id']
```

### Key Concepts:

-   **`serializers.ModelSerializer`**: This is a "magic" class from DRF that will automatically generate a set of fields for you based on a Django model.
-   **`class Meta`**: This inner class is where you configure the serializer.
    -   `model = Volunteer`: Tells the serializer which model to use.
    -   `fields = [...]`: An explicit list of the model fields that should be included in the API representation.
    -   `read_only_fields = [...]`: This is a crucial security and data integrity feature. It prevents clients from directly writing to these fields. For example, a user cannot just set their own status to `'approved'`; that can only be done by the backend logic in the view.

---

## 2. The ViewSet: Handling API Logic

A ViewSet defines the logic for a set of related API endpoints. DRF provides `ModelViewSet`, which automatically gives us a full set of CRUD (Create, Read, Update, Delete) operations for a model.

**File:** `hopehands/volunteer/api_views.py`

```python
from rest_framework import viewsets
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated
from .models import Volunteer
from .serializers import VolunteerSerializer

class VolunteerViewSet(viewsets.ModelViewSet):
    queryset = Volunteer.objects.all().order_by('-id')
    serializer_class = VolunteerSerializer
    permission_classes = [IsAuthenticated]

    @action(detail=True, methods=['post'], url_path='approve')
    def approve(self, request, pk=None):
        """
        Custom action to approve a volunteer application.
        """
        volunteer = self.get_object()
        # ... approval logic ...
        return Response({'status': 'volunteer approved'})
```

### Key Concepts:

-   **`viewsets.ModelViewSet`**: By inheriting from this class, we automatically get handlers for `list` (GET /volunteers/), `create` (POST /volunteers/), `retrieve` (GET /volunteers/{id}/), `update` (PUT /volunteers/{id}/), and `destroy` (DELETE /volunteers/{id}/) requests.
-   **`queryset`**: The set of all objects that this viewset can operate on.
-   **`serializer_class`**: Tells the viewset to use our `VolunteerSerializer` for converting data.
-   **`permission_classes`**: Specifies that only authenticated users can access these endpoints.
-   **`@action` Decorator**: This is how we add our own custom functionality beyond the standard CRUD operations.
    -   `detail=True`: Means this action operates on a single object (e.g., a specific volunteer).
    -   `methods=['post']`: Restricts this action to `POST` requests.
    -   `url_path='approve'`: Sets the URL fragment for this action. The full URL will be `/api/volunteers/{id}/approve/`.

---

## 3. The Router: Wiring up the URLs

The final step is to connect our `VolunteerViewSet` to a set of URLs. DRF's router class makes this incredibly simple.

**File:** `hopehands/volunteer/api_urls.py`

```python
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from . import api_views

# A router automatically generates the URLs for a ViewSet.
router = DefaultRouter()
# Register the VolunteerViewSet with the router under the 'volunteers' endpoint.
router.register(r'volunteers', api_views.VolunteerViewSet, basename='volunteer')

urlpatterns = [
    # ... other url patterns for login, signup, etc. ...

    # Include the URLs generated by the router.
    path('', include(router.urls)),
]
```

### Key Concepts:

-   **`DefaultRouter`**: This class generates a whole set of URL patterns for a registered viewset.
-   **`router.register(...)`**: This single line of code connects the `VolunteerViewSet` to the base URL `volunteers/`. The router then automatically creates all the necessary URLs for the standard CRUD actions and our custom `@action`s:
    -   `GET /api/volunteers/`
    -   `POST /api/volunteers/`
    -   `GET /api/volunteers/{id}/`
    -   `PUT /api/volunteers/{id}/`
    -   `DELETE /api/volunteers/{id}/`
    -   `POST /api/volunteers/{id}/approve/`
    -   `POST /api/volunteers/{id}/reject/`

This combination of `ModelSerializer`, `ModelViewSet`, and `DefaultRouter` allows us to build a complete, robust, and secure set of API endpoints with very little boilerplate code.
